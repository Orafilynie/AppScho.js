"use strict";var e="undefined"!=typeof document?document.currentScript:null,o=o=>new URL(`../logos/${o}`,"undefined"==typeof document?require("url").pathToFileURL(__filename).href:e&&"SCRIPT"===e.tagName.toUpperCase()&&e.src||new URL("index.js",document.baseURI).href),t=[{id:"bsb",logo:o("bsb.webp"),name:"Burgundy School of Business"},{id:"edhec",logo:o("edhec.webp"),name:"EDHEC Business School"},{id:"emstra",logo:o("emstra.webp"),name:"EM Strasbourg INSIDE"},{casurl:"https://gge-fra.onelogin.com/oidc/2/auth",clientid:"04a71590-4e7e-013d-0d74-4224903aba3737627",id:"esarc",logo:o("esarc.webp"),name:"ESARC go",scope:"openid+profile+email+params+groups",uriend:!1},{casurl:"https://gge-fra.onelogin.com/oidc/2/auth",clientid:"9ffb9be0-4e7d-013d-5b5d-123144e9468637627",id:"esg",logo:o("esg.webp"),name:"ESG Live",scope:"openid+profile+email+params+groups",uriend:!1},{id:"essec",logo:o("essec.webp"),name:"ESSEC Business School"},{casurl:"https://gge-fra.onelogin.com/oidc/2/auth",clientid:"63a20580-4e7f-013d-983f-3ae74bc6093237627",id:"digitalcampus",logo:o("digitalcampus.webp"),name:"GGE - Digital Campus",scope:"openid+profile+email+params+groups",uriend:!1},{casurl:"https://gge-deu.onelogin.com/oidc/2/auth",clientid:"ba5a9ba0-88f8-013a-9a42-02ce5bf6a8b437628",id:"macromedia",logo:o("macromedia.webp"),name:"Galileo Global Education Germany",scope:"openid+profile+email+params+groups",uriend:!1},{id:"hec",logo:o("hec.webp"),name:"HEC Paris"},{id:"icp",logo:o("icp.png"),name:"ICP"},{id:"ipp",logo:o("ipp.webp"),name:"IP Paris Campus"},{id:"ieu",logo:o("ieu.webp"),name:"Instituto de Estudios Universitarios"},{id:"ieseg",logo:o("iseg.webp"),name:"IÉSEG Connect"},{casurl:"https://gge-fra.onelogin.com/oidc/2/auth",clientid:"29e9c370-4e80-013d-885d-0abcaae3a4cf37627",id:"lisaa",logo:o("lisaa.webp"),name:"LISAA Campus",scope:"openid+profile+email+params+groups",uriend:!1},{casurl:"https://gge-fra.onelogin.com/oidc/2/auth",clientid:"f2d6ed00-7e43-013d-0e35-020afc8f024837627",id:"merkure",logo:o("merkure.webp"),name:"Merkure Live",scope:"openid+profile+email+params+groups",uriend:!1},{id:"mbs",logo:o("mbs.webp"),name:"Montpellier Business School"},{id:"eigsi",logo:o("eigsi.webp"),name:"My EIGSI"},{id:"essca",logo:o("essca.webp"),name:"My ESSCA"},{id:"ucly",logo:o("ucly.webp"),name:"My Ucly"},{casurl:"https://gge-fra.onelogin.com/oidc/2/auth",clientid:"df9f8d90-4e7e-013d-9599-3e3983e056fd37627",id:"alijia",logo:o("alijia.webp"),name:"MyELIJE",scope:"openid+profile+email+params+groups",uriend:!1},{id:"epp",logo:o("epp.webp"),name:"MyEPP"},{id:"esigelec",logo:o("esigelec.webp"),name:"MyESIGELEC"},{id:"estp",logo:o("estp.webp"),name:"MyESTP"},{id:"esaip",logo:o("esaip.webp"),name:"MyEsaip"},{casurl:"https://gge-fra.onelogin.com/oidc/2/auth",clientid:"2fe63b60-bff1-013b-ddc6-0668df09704237627",id:"iicp",logo:o("iicp.webp"),name:"Narratiiv Inside",scope:"openid+profile+email+params+groups",uriend:!1},{id:"domus",name:"Nuova Accademia: MyDA"},{id:"ueve",logo:o("ueve.webp"),name:"OFIL UnivEvry"},{casurl:"https://gge-fra.onelogin.com/oidc/2/auth",clientid:"23cc4030-4e7d-013d-b0f6-4e4814bd4e6d37627",id:"pstb",logo:o("pstb.webp"),name:"PSTB",scope:"openid+profile+email+params+groups",uriend:!1},{id:"psb",logo:o("psb.jpg"),name:"Paris School Of Business"},{casurl:"https://gge-gbr.onelogin.com/oidc/2/auth",clientid:"d29993a0-6b00-013a-7b8e-02732a18081038446",id:"regent",logo:o("regent.webp"),name:"Regent's University London",scope:"openid+profile+email+params+groups",uriend:!1},{id:"sciencespo",logo:o("sciencepo.webp"),name:"Sciences Po"},{id:"scpoaix",logo:o("scpoaix.webp"),name:"Sciences Po Aix"},{id:"ubmont",logo:o("ubmont.webp"),name:"Université Bordeaux Montaigne"},{id:"uclouvain",logo:o("uclouvain.webp"),name:"Université Catholique de Louvain"},{casurl:"https://cas.univ-eiffel.fr/oidc/authorize",clientid:"726a397e14d8465e80a46202",id:"unieiffel",logo:o("univeiffel.webp"),name:"Université Gustave Eiffel",uriend:!0},{id:"unilyon3",logo:o("unilyon3.webp"),name:"Université Jean Moulin Lyon3"},{casurl:"https://cas.u-paris2.fr/cas/oidc/authorize",clientid:"973379d68bb7da4533b84c45eaf2c9fd",id:"uniassas",logo:o("uniassas.webp"),name:"Université Paris-Panthéon-Assas",uriend:!0},{id:"univangers",logo:o("univangers.webp"),name:"Université d'Angers"},{id:"unimons",logo:o("unimons.webp"),name:"Université de Mons"},{id:"unimes",logo:o("unimes.webp"),name:"Université de Nîmes"},{casurl:"https://cas.u-picardie.fr/oidc/authorize",clientid:"AppSchoProd",id:"upjv",logo:o("upjv.webp"),name:"Université de Picardie Jules Verne",uriend:!0},{id:"univpoitiers",logo:o("univpoitiers.webp"),name:"Université de Poitiers"},{casurl:"https://cas.univ-tln.fr/cas/oidc/authorize",clientid:"appscho",id:"unitoulon",logo:o("unitoulon.webp"),name:"Université de Toulon",uriend:!1},{casurl:"https://gge-fra.onelogin.com/oidc/2/auth",clientid:"269eb430-4e7f-013d-80d4-06e3653b829437627",id:"wsfactory",logo:o("wsfactory.png"),name:"Web School Factory",scope:"openid+profile+email+params+groups",uriend:!1}],r=e=>`https://api.appscho.com/${e}`,s=e=>`https://my.appscho.com/api/${e}`,n=e=>`https://feed.appscho.com/api/m/v1/${e}`,a=class extends Error{constructor(e){super(e),this.name="AppSchoError"}},i=class extends a{constructor(e){super(`CAS authentication is not supported for instance "${e}"`),this.name="CASNotSupportedError"}},c=class extends a{constructor(){super("Internal server error, please try again later"),this.name="InternalServerError"}},p=class extends a{constructor(){super("Your account does not have a planning subscription, please check your intranet"),this.name="NoPlanningSubscriptionError"}},d=class extends a{constructor(){super("Not found, your instance probably doesn't have this feature"),this.name="NotFoundError"}},u=class extends a{constructor(){super("Unauthorized, please check your credentials or token"),this.name="UnauthorizedError"}},l=e=>{switch(e.state){case"ok":return e.response;case"unauthorized":throw new u;case"internal_server_error":throw new c;default:throw new d}},h=e=>{try{const o=(e=>{try{const o=e.split(".");if(3!==o.length)throw new Error("Invalid JWT format");const t=o[1];return JSON.parse(atob(t.replace(/-/g,"+").replace(/_/g,"/")))}catch(e){throw new Error(`Failed to decode JWT: ${e instanceof Error?e.message:"Unknown error"}`)}})(e);return o.department||null}catch(e){return null}},g=(e,o,t)=>({department:h(o),firstname:e.firstname,id_token:e.id_token,lastname:e.lastname,picture:e.picture||"",program:e.program,refreshToken:t,token:o}),w=e=>{const o=t.find(o=>o.id===e);if(!o)throw new Error(`Unknown instance: ${e}`);if(!o.casurl||!o.clientid)throw new i(e)},m=async(e,o)=>{try{if(!o)throw new Error("Refresh token is required");const t=await fetch(`${r(e)}/oauth/refresh`,{body:`refresh_token=${o}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST"});if(!t.ok)throw new Error(`Token refresh failed: ${t.status} ${t.statusText}`);const s=await t.json();if(!s.access_token)throw new Error("Invalid refresh response: missing access_token");return s}catch(e){if(e instanceof TypeError&&e.message.includes("fetch"))throw new Error("Network error: Unable to connect to AppScho API");throw e}};exports.AppSchoError=a,exports.CASNotSupportedError=i,exports.INSTANCES=t,exports.InternalServerError=c,exports.NoPlanningSubscriptionError=p,exports.NotFoundError=d,exports.UnauthorizedError=u,exports.getCASURL=e=>{w(e);const o=t.find(o=>o.id===e),r=((e=8)=>{const o="0123456789ABCDEF";let t="";for(let r=0;r<e;r++)t+=o.charAt(Math.floor(16*Math.random()));return t})(8),s=!1===o.uriend?`https://${e}.callback.oauth.appscho.com`:`https://${e}.callback.oauth.appscho.com/`;let n=new URLSearchParams({client_id:o.clientid,redirect_uri:s,response_type:"code",state:r}).toString();return o.scope&&(n+=`&scope=${o.scope}`),`${o.casurl}?${n}`},exports.getCareerEvents=async e=>(await fetch(`${r(e)}/career/events`)).json(),exports.getCrous=async(e,o)=>{const t=await fetch(`${r(e)}/crous`,{headers:{"X-Appscho-Token":o}}),s=await t.json();return l(s)},exports.getCrousRestaurants=async(e,o,t)=>{const s=await fetch(`${r(e)}/crous/${t}/restaurants`,{headers:{"X-Appscho-Token":o}}),n=await s.json();return l(n)},exports.getEventsFeed=async e=>{const o=await fetch(`${r(e)}/events`),t=await o.json();return l(t)},exports.getExternalServices=async e=>(await fetch(`${s(e)}/webviews`)).json(),exports.getFacebookFeed=async e=>{const o=await fetch(`${r(e)}/facebook`),t=await o.json();return l(t)},exports.getFeedChannels=async e=>(await fetch(`${n(e)}/channels`)).json(),exports.getFeedPosts=async e=>(await fetch(`${n(e)}/posts`)).json(),exports.getKnowledgebase=async e=>(await fetch(`https://my.appscho.com/api/v3/${e}/knowledgebase`)).json(),exports.getLocations=async e=>(await fetch(`${s(e)}/locations`)).json(),exports.getMetadata=async(e,o)=>{const t=await fetch(`https://metadata.appscho.com/versions/${e}/${o}/production`),r=await t.json();return l(r)},exports.getNewsFeed=async e=>{const o=await fetch(`${r(e)}/news`),t=await o.json();return l(t)},exports.getPlanning=async(e,o)=>{try{const t=await fetch(`${r(e)}/planning`,{headers:{"X-Appscho-Token":o}});if(500===t.status)throw new p;if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const s=await t.json();return l(s)}catch(e){if(e instanceof p)throw e;if(e instanceof TypeError&&e.message.includes("fetch"))throw new Error("Network error: Unable to connect to AppScho API");throw e}},exports.getProfiles=async e=>(await fetch(`${s(e)}/profiles`)).json(),exports.getQuickAccesses=async e=>(await fetch(`${s(e)}/quickaccess`)).json(),exports.getTwitterFeed=async e=>{const o=await fetch(`${r(e)}/twitter`),t=await o.json();return l(t)},exports.getYouTubeFeed=async e=>{const o=await fetch(`${r(e)}/youtube`),t=await o.json();return l(t)},exports.loginWithCredentials=async(e,o,t)=>{try{const s=await fetch(`${r(e)}/login`,{headers:{"X-Appscho-EncodedToken":"1","X-Appscho-Id":o,"X-Appscho-Token":btoa(t)}});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const n=await s.json(),a=l(n),i=h(a.token);return{...a,department:i}}catch(e){if(e instanceof TypeError&&e.message.includes("fetch"))throw new Error("Network error: Unable to connect to AppScho API");throw e}},exports.loginWithOAuth=async(e,o)=>{try{w(e);const t=await fetch(`${r(e)}/oauth/token`,{body:`code=${o}&grant_type=authorization_code`,headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST"});if(!t.ok)throw new Error(`OAuth token exchange failed: ${t.status} ${t.statusText}`);const s=await t.json();if(!s.access_token)throw new Error("Invalid OAuth response: missing access_token");const n=await fetch(`${r(e)}/whoami`,{headers:{"X-Appscho-Token":s.access_token}});if(!n.ok)throw new Error(`User data fetch failed: ${n.status} ${n.statusText}`);const a=await n.json(),i=l(a);return g(i,s.access_token,s.refresh_token)}catch(e){if(e instanceof TypeError&&e.message.includes("fetch"))throw new Error("Network error: Unable to connect to AppScho API");throw e}},exports.refreshOAuthToken=m,exports.refreshOAuthTokenWithUser=async(e,o)=>{try{const t=await m(e,o),s=await fetch(`${r(e)}/whoami`,{headers:{"X-Appscho-Token":t.access_token}});if(!s.ok)throw new Error(`User data fetch failed: ${s.status} ${s.statusText}`);const n=await s.json(),a=l(n);return g(a,t.access_token,t.refresh_token)}catch(e){if(e instanceof TypeError&&e.message.includes("fetch"))throw new Error("Network error: Unable to connect to AppScho API");throw e}};//# sourceMappingURL=index.js.map